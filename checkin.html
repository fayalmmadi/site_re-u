<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Re√ßu de mont√©e</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background-color: #f4f4f4;
      text-align: center;
    }
    .box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
      margin-top: 30px;
    }
    button {
      background-color: #2e7d32;
      color: white;
      padding: 10px 20px;
      border: none;
      margin-top: 10px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üü¢ Re√ßu de mont√©e</h2>
  <div id="recu">Chargement...</div>

  <script>
    // R√©cup√©ration des param√®tres d‚ÄôURL
    const urlParams = new URLSearchParams(window.location.search);
    const chauffeurId = urlParams.get('chauffeurId');
    const valid = urlParams.get('valid');

    const now = new Date();
    const today = now.toISOString().substring(0, 10);
    const heure = now.toTimeString().substring(0, 8);

    // Affichage visuel du re√ßu
    document.getElementById('recu').innerHTML = `
      <div class="box">
        <p><strong>ID Chauffeur :</strong> ${chauffeurId}</p>
        <p><strong>Date :</strong> ${today}</p>
        <p><strong>Heure :</strong> ${heure}</p>
        <p><strong>Mois de validit√© :</strong> ${valid}</p>
        <p>‚úÖ Vous √™tes bien mont√© dans le taxi.</p>
        <button onclick="window.print()">T√©l√©charger / Imprimer le re√ßu</button>
      </div>
    `;

    // Logs de d√©bogage
    console.log("‚û°Ô∏è D√©but insertion Supabase");
    console.log("chauffeur_id =", chauffeurId);
    console.log("date =", today);
    console.log("heure =", heure);

    // Requ√™te vers fonction Netlify
    fetch('/.netlify/functions/add_passager', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chauffeur_id: chauffeurId,
        nombre_passagers: 1,
        date: today,
        heure: heure,
        montant: 0
     })
   })
   .then(res => {
     if (!res.ok) {
       throw new Error("Erreur insertion : " + res.status);
     }
     return res.json();
   })
   .then(data => {
     console.log("‚úÖ Insertion OK :", data);
   })
   .catch(err => {
     console.error("‚ùå Erreur insertion :", err);
     alert("Erreur insertion : " + err.message);
   });

  </script>
</body>
</html>

